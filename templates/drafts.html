{% extends "base.html" %} {% block title %}ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ - Todo List App{%
endblock %} {% block content %}
<div class="drafts-container">
  <div class="todo-header">
    <h2>ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿</h2>
    <div class="todo-header-actions">
      <a href="{{ url_for('simple_list') }}" class="btn btn-secondary">ä¸€è¦§</a>
      <a href="{{ url_for('index') }}" class="btn btn-secondary">è©³ç´°è¡¨ç¤º</a>
      <a href="{{ url_for('create_todo') }}" class="btn btn-primary"
        >æ–°è¦ä½œæˆ</a
      >
    </div>
  </div>

  <div id="drafts-section">
    <div id="drafts-list" class="drafts-list"></div>
    <div id="drafts-empty" class="empty-state" style="display: none">
      <p class="empty-message">ğŸ“ ä¸€æ™‚ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const DRAFTS_STORAGE_KEY = "todo_drafts";
    const draftsList = document.getElementById("drafts-list");
    const draftsEmpty = document.getElementById("drafts-empty");

    // ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    function getDrafts() {
      try {
        const draftsJson = localStorage.getItem(DRAFTS_STORAGE_KEY);
        return draftsJson ? JSON.parse(draftsJson) : [];
      } catch (e) {
        console.error("ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚¨ãƒ©ãƒ¼:", e);
        return [];
      }
    }

    // ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
    function displayDrafts() {
      const drafts = getDrafts();

      if (drafts.length === 0) {
        draftsList.style.display = "none";
        draftsEmpty.style.display = "block";
        return;
      }

      draftsList.style.display = "block";
      draftsEmpty.style.display = "none";
      draftsList.innerHTML = "";

      drafts.forEach((draft) => {
        const draftItem = document.createElement("div");
        draftItem.className = "draft-item";

        const savedDate = new Date(draft.saved_at);
        const formattedDate = savedDate.toLocaleString("ja-JP", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });

        draftItem.innerHTML = `
          <div class="draft-content">
            <div class="draft-title">${draft.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)"}</div>
            <div class="draft-meta">
              <span>æœŸæ—¥: ${draft.due_date || "(æœªè¨­å®š)"}</span>
              <span>ä¿å­˜æ—¥æ™‚: ${formattedDate}</span>
            </div>
            ${
              draft.content
                ? `<div class="draft-description">${draft.content}</div>`
                : ""
            }
          </div>
          <div class="draft-actions">
            <button class="btn btn-primary btn-sm" onclick="loadDraft('${
              draft.id
            }')">
              èª­ã¿è¾¼ã‚€
            </button>
            <button class="btn btn-delete btn-sm" onclick="deleteDraft('${
              draft.id
            }')">
              å‰Šé™¤
            </button>
          </div>
        `;

        draftsList.appendChild(draftItem);
      });
    }

    // ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    window.loadDraft = function (draftId) {
      window.location.href = "{{ url_for('create_todo') }}?draft_id=" + draftId;
    };

    // ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
    window.deleteDraft = function (draftId) {
      if (!confirm("ã“ã®ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
        return;
      }

      try {
        const drafts = getDrafts();
        const filteredDrafts = drafts.filter((d) => d.id !== draftId);
        localStorage.setItem(
          DRAFTS_STORAGE_KEY,
          JSON.stringify(filteredDrafts)
        );
        displayDrafts();
      } catch (e) {
        console.error("ä¸€æ™‚ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", e);
        alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    };

    // åˆæœŸè¡¨ç¤º
    displayDrafts();
  });
</script>
{% endblock %}
