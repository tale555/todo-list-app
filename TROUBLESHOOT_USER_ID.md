# User IDが表示されない場合の対処法

## 🔍 確認事項

### 1. Flaskアプリのターミナルを確認

**重要**: Flaskアプリを起動したターミナル（`python main.py` を実行したターミナル）を確認してください。

- ターミナルを上にスクロールして、過去のメッセージを確認してください
- 友だち追加イベントは、友だち追加した瞬間に表示されます

### 2. メッセージを送信してみる

友だち追加イベントが表示されない場合でも、**メッセージイベント**でUser IDを取得できます：

1. LINE公式アカウントにメッセージを送信（例: 「テスト」）
2. Flaskアプリのターミナルに以下のようなメッセージが表示されます：

```
============================================================
✅ メッセージイベントを受信しました！
   User ID: U1234567890abcdefghijklmnopqrstuvw
   このUser IDを.envファイルのLINE_USER_IDに設定してください
============================================================
```

### 3. Webhookの設定を確認

LINE Developers Consoleで以下を確認：

1. **Webhook URL**が正しく設定されているか
   - `https://aeromarine-colt-catoptrical.ngrok-free.dev/line/webhook`
   - `/line/webhook` が含まれているか確認

2. **「Webhookの利用」がONになっているか**

3. **「検証」ボタンで成功しているか**

### 4. ngrokのログを確認

ngrokのターミナルで、以下のようなリクエストが記録されているか確認：

```
POST /line/webhook             200 OK
```

記録されていれば、Webhookは正常に動作しています。

### 5. Flaskアプリのログを確認

Flaskアプリのターミナルで、以下のようなメッセージが表示されているか確認：

```
✅ Webhook検証リクエストを受信しました
```

または

```
⚠️  Webhookエラー: ...
```

エラーメッセージが出ている場合は、その内容を確認してください。

## 💡 推奨手順

1. **LINE公式アカウントにメッセージを送信**
   - 例: 「テスト」と送信
   - これでメッセージイベントが発生し、User IDが表示されます

2. **Flaskアプリのターミナルを確認**
   - メッセージ送信後、すぐにUser IDが表示されます

3. **User IDをコピー**
   - `U`で始まる長い文字列をコピー

4. **.envファイルに設定**
   ```env
   LINE_USER_ID=コピーしたUser ID
   ```

## 🔧 それでも表示されない場合

### デバッグモードを有効にする

Flaskアプリのターミナルで、Webhookイベントの詳細を確認できるように、`main.py`の`line_webhook`関数にデバッグログを追加します。

または、以下のコマンドでWebhookの動作を確認：

```bash
python check_ngrok_url.py
```

ngrokが正常に動作しているか確認できます。

